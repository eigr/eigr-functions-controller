syntax = "proto3";

package io.eigr.permastate.operator;

message Session {
    string id = 1;
}

message Login {
    Session session = 1;
}

message Logout {
    Session session = 1;
}

message Resource {
    string name = 1;
    map<string, string> metadata = 2;
    enum Kind {
        STATEFUL_SERVICE = 0;
        STATEFUL_STORE = 1;
        CONFIG_MAP = 2;
        SECRETS = 3;
        SERVICE = 4;
    }
    Kind kind = 3;
}

message Scale {
    int32 replicas = 1;
    Resource resource = 2;
}

message Create {
    Resource resource = 1;
}

message Delete {
    Resource resource = 1;
}

message Modify {
    Resource resource = 1;
}

message Apply {
    oneof action {
        Scale scale = 1;
        Delete delete = 2;
    }
    Session session = 3;
}

message Event {
    oneof data {
        // Server events
        Create create = 1;
        Delete delete = 2;
        Modify modify = 3;

        // Client events
        Login loging = 4;
        Logout logout = 5;
        Apply apply = 6;
    }
}

service OperatorService {
    rpc HandleEvents(stream Event) returns (stream Event) {}
}

